package com.betacom.car.utilities;

import com.betacom.car.dao.BiciDAO;
import com.betacom.car.dao.MacchinaDAO;
import com.betacom.car.dao.MotoDAO;
import com.betacom.car.dao.VeicoloDAO;

public class GestioneMetodi {

    private final VeicoloDAO daoV;
    private final MacchinaDAO daoM;
    private final MotoDAO daoMo;
    private final BiciDAO daoB;

    public GestoreComandi(VeicoloDAO daoV, MacchinaDAO daoM, MotoDAO daoMo, BiciDAO daoB) {
        this.daoV = daoV;
        this.daoM = daoM;
        this.daoMo = daoMo;
        this.daoB = daoB;
    }

	private void gestisciAddGenerico(String riga) throws Exception {

		String[] parti = riga.split(":");
		if (parti.length < 2)
			return;

		String[] valori = parti[1].split(",");
		String tipo = valori[0].toLowerCase();

		switch (tipo) {
		case "macchina" -> insertMacchina(valori);
		case "moto" -> insertMoto(valori);
		case "bici" -> insertBici(valori);
		default -> System.out.println("Tipo non gestito: " + tipo);
		}
	}

    public void gestisciUpdate(String riga) throws Exception {
        // copia qui quello di gestisciUpdateGenerico
    }

    public void gestisciDelete(String riga) throws Exception {
        // copia qui quello di gestisciDeleteGenerico
    }

    public void gestisciList(String riga) throws Exception {
        // copia qui quello di gestisciListGenerico
    }

	private void insertMacchina(String[] c) throws Exception {
		int idNumeroRuote = Utils.getIdFromValue("numeroruote", "numeroruote", c[1]);
		int idAlim = Utils.getIdFromValue("alimentazione", "alimentazione", c[2]);
		int idCat = Utils.getIdFromValue("categoria", "categoria", c[3]);
		int idColore = Utils.getIdFromValue("colore", "colore", c[4]);
		int idMarca = Utils.getIdFromValue("marca", "marca", c[5]);
		int anno = Integer.parseInt(c[6]);
		int idModello = Utils.getIdFromValue("modello", "modello", c[7]);
		int porte = Integer.parseInt(c[8]);
		String targa = c[9];
		int cc = Integer.parseInt(c[10]);

		int idMacchina = daoM.insert("insert_macchina", new Object[] { porte, targa, cc });
		Object[] veicoloParams = { anno, idNumeroRuote, idAlim, idCat, idColore, idMarca, idModello, idMacchina, null,
				null };
		daoV.insert("insert_veicolo", veicoloParams);
	}

	private void insertMoto(String[] c) throws Exception {
		int idNumeroRuote = Utils.getIdFromValue("numeroruote", "numeroruote", c[1]);
		int idAlim = Utils.getIdFromValue("alimentazione", "alimentazione", c[2]);
		int idCat = Utils.getIdFromValue("categoria", "categoria", c[3]);
		int idColore = Utils.getIdFromValue("colore", "colore", c[4]);
		int idMarca = Utils.getIdFromValue("marca", "marca", c[5]);
		int anno = Integer.parseInt(c[6]);
		int idModello = Utils.getIdFromValue("modello", "modello", c[7]);
		String targa = c[8];
		int cc = Integer.parseInt(c[9]);

		int idMoto = daoMo.insert("insert_moto", new Object[] { targa, cc });
		Object[] veicoloParams = { anno, idNumeroRuote, idAlim, idCat, idColore, idMarca, idModello, null, idMoto,
				null };
		daoV.insert("insert_veicolo", veicoloParams);
	}

	private void insertBici(String[] c) throws Exception {
		int idNumeroRuote = Utils.getIdFromValue("numeroruote", "numeroruote", c[1]);
		int idAlim = Utils.getIdFromValue("alimentazione", "alimentazione", c[2]);
		int idCat = Utils.getIdFromValue("categoria", "categoria", c[3]);
		int idColore = Utils.getIdFromValue("colore", "colore", c[4]);
		int idMarca = Utils.getIdFromValue("marca", "marca", c[5]);
		int anno = Integer.parseInt(c[6]);
		int idModello = Utils.getIdFromValue("modello", "modello", c[7]);
		int marce = Integer.parseInt(c[8]);
		int idSosp = Utils.getIdFromValue("sospensione", "sospensione", c[9]);
		boolean pieghevole = Boolean.parseBoolean(c[10]);

		int idBici = daoB.insert("insert_bici", new Object[] { marce, idSosp, pieghevole });
		Object[] veicoloParams = { anno, idNumeroRuote, idAlim, idCat, idColore, idMarca, idModello, null, null,
				idBici };
		daoV.insert("insert_veicolo", veicoloParams);
	}

	private void updateMacchina(int id, String[] campi) throws Exception {

		String targa = null;
		Integer porte = null;
		Integer cc = null;

		for (String campo : campi) {
			String[] coppia = campo.split("=");
			switch (coppia[0]) {
			case "targa" -> targa = coppia[1];
			case "porte" -> porte = Integer.parseInt(coppia[1]);
			case "cc" -> cc = Integer.parseInt(coppia[1]);
			}
		}

		Object[] params = { porte != null ? porte : 0, targa != null ? targa : "", cc != null ? cc : 0, id };
		int updated = daoM.update("update_macchina", params);
		System.out.println("Update macchina - righe modificate: " + updated);
	}

	private void updateMoto(int id, String[] campi) throws Exception {

		String targa = null;
		Integer cc = null;

		for (String campo : campi) {
			String[] coppia = campo.split("=");
			switch (coppia[0]) {
			case "targa" -> targa = coppia[1];
			case "cc" -> cc = Integer.parseInt(coppia[1]);
			}
		}

		Object[] params = { targa != null ? targa : "", cc != null ? cc : 0, id };
		int updated = daoMo.update("update_moto", params);
		System.out.println("Update moto - righe modificate: " + updated);
	}

	private void updateBici(int id, String[] campi) throws Exception {

		Integer marce = null;
		Integer idSospensione = null;
		Boolean pieghevole = null;

		for (String campo : campi) {
			String[] coppia = campo.split("=");
			switch (coppia[0]) {
			case "marce" -> marce = Integer.parseInt(coppia[1]);
			case "sospensione" -> idSospensione = Utils.getIdFromValue("sospensione", "tipoSospensione", coppia[1]);
			case "pieghevole" -> pieghevole = Boolean.parseBoolean(coppia[1]);
			}
		}

		Object[] params = { marce != null ? marce : 0, idSospensione != null ? idSospensione : 0,
				pieghevole != null ? pieghevole : false, id };

		int updated = daoB.update("update_bici", params);
		System.out.println("Update bici - righe modificate: " + updated);
	}
	
}
